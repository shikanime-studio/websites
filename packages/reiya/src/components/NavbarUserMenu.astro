---
import { BsBoxArrowRight, BsFillPersonVcardFill } from "react-icons/bs";
import { getAccount } from "../lib/account";
import { Image } from "astro:assets";
import { getD1Database } from "../lib/util";

const db = getD1Database(Astro.locals);
const account = await getAccount(db, Astro.props.accountId);
---

<div class="dropdown dropdown-end">
  <div tabindex="0" role="button"  class="btn btn-ghost btn-circle avatar">
    {
      account && (
        <div class="w-10 rounded-full">
          <Image
            src={account.pictureUrl}
            alt={`${account.name ?? account.email ?? "Me"} Avatar`}
            width="46"
            height="46"
            loading="eager"
          />
        </div>
      )
    }
  </div>
  <ul
    tabindex={0}
    class="menu dropdown-content z-50 w-52 rounded-box bg-base-100 p-2 shadow"
  >
    <li>
      <a href="/account">
        <BsFillPersonVcardFill />
        Account
      </a>
    </li>
    <li>
      <a href={`/logout?redirect=${Astro.url.toString()}`}>
        <BsBoxArrowRight />
        Logout
      </a>
    </li>
  </ul>
</div>
