---
import { Image } from "astro:assets";
import { validateSession } from "../lib/session";
import UserMenu from "./NavbarUserMenu.astro";
import logoImage from "../assets/logo.png";
import { getD1Database } from "../lib/util";

const db = getD1Database(Astro.locals);

let session: Awaited<ReturnType<typeof validateSession>> | undefined;
try {
  session = await validateSession(db, Astro.cookies);
} catch (e) {
  if (e instanceof Error && e.message !== "No session") {
    throw e;
  }
}
---

<nav
  class="z-20 mx-auto flex w-full justify-between md:w-4/5 lg:w-4/5 xl:w-3/5"
>
  <div class="navbar">
    <div class="navbar-start">
      <a href="/" class="ml-2 flex md:mr-24">
        <Image
          src={logoImage}
          class="mr-3"
          alt="Reiya Logo"
          width="46"
          height="46"
          loading="eager"
        />
        <span
          class="self-center whitespace-nowrap text-xl font-semibold sm:text-2xl"
        >
          Reiya
        </span>
      </a>
    </div>
    <div class="navbar-center"></div>
    <div class="navbar-end">
      <ul class="menu menu-horizontal px-1">
        <li><a href="https://shikanime.medium.com">Blog</a></li>
      </ul>
      <div class="ml-3 flex items-center">
        {
          session ? (
            <UserMenu accountId={session.accountId} />
          ) : (
            <a class="btn btn-primary rounded-full" href="/flows/google">
              Sign up for free
            </a>
          )
        }
      </div>
    </div>
  </div>
</nav>
