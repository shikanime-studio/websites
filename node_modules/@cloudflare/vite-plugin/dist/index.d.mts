import { Miniflare, Request, Response } from "miniflare";
import { Unstable_Config } from "wrangler";
import * as vite from "vite";
import { getLocalWorkerdCompatibilityDate } from "@cloudflare/workers-utils";

//#region src/utils.d.ts

type Defined<T> = Exclude<T, undefined>;
//#endregion
//#region src/workers-configs.d.ts

type WorkerConfig = Omit<Unstable_Config, keyof NonApplicableConfig>;
type NonApplicableWorkerConfigsInfo = typeof nonApplicableWorkerConfigs;
type NonApplicableConfig = NonApplicableConfigReplacedByVite | NonApplicableConfigNotRelevant;
type NonApplicableConfigReplacedByVite = keyof NonApplicableWorkerConfigsInfo["replacedByVite"];
type NonApplicableConfigNotRelevant = NonApplicableWorkerConfigsInfo["notRelevant"][number];
/**
 * Set of worker config options that are not applicable when using Vite
 */
declare const nonApplicableWorkerConfigs: {
  /**
   * Object containing configs that have a vite replacement, the object's field contain details about the config's replacement
   */
  readonly replacedByVite: {
    readonly alias: {
      readonly viteReplacement: "resolve.alias";
      readonly viteDocs: "https://vite.dev/config/shared-options.html#resolve-alias";
    };
    readonly define: {
      readonly viteReplacement: "define";
      readonly viteDocs: "https://vite.dev/config/shared-options.html#define";
    };
    readonly minify: {
      readonly viteReplacement: "build.minify";
      readonly viteDocs: "https://vite.dev/config/build-options.html#build-minify";
    };
  };
  /**
   * All the configs that are not relevant when using Vite (meaning that in the context of a Vite
   * application they lose their purpose/meaning)
   */
  readonly notRelevant: readonly ["base_dir", "build", "find_additional_modules", "no_bundle", "preserve_file_names", "rules", "site", "tsconfig"];
};
//#endregion
//#region src/plugin-config.d.ts
type PersistState = boolean | {
  path: string;
};
interface BaseWorkerConfig {
  viteEnvironment?: {
    name?: string;
  };
}
interface EntryWorkerConfig extends BaseWorkerConfig {
  configPath?: string;
}
interface AuxiliaryWorkerFileConfig extends BaseWorkerConfig {
  configPath: string;
}
interface AuxiliaryWorkerInlineConfig extends BaseWorkerConfig {
  configPath?: string;
  config: WorkerConfigCustomizer<false>;
}
type AuxiliaryWorkerConfig = AuxiliaryWorkerFileConfig | AuxiliaryWorkerInlineConfig;
interface Experimental {
  /** Experimental support for handling the _headers and _redirects files during Vite dev mode. */
  headersAndRedirectsDevModeSupport?: boolean;
}
type FilteredEntryWorkerConfig = Omit<ResolvedAssetsOnlyConfig, "topLevelName" | "name">;
type WorkerConfigCustomizer<TIsEntryWorker extends boolean> = Partial<WorkerConfig> | ((...args: TIsEntryWorker extends true ? [config: WorkerConfig] : [config: WorkerConfig, {
  entryWorkerConfig: FilteredEntryWorkerConfig;
}]) => Partial<WorkerConfig> | void);
interface PluginConfig extends EntryWorkerConfig {
  auxiliaryWorkers?: AuxiliaryWorkerConfig[];
  persistState?: PersistState;
  inspectorPort?: number | false;
  remoteBindings?: boolean;
  experimental?: Experimental;
  config?: WorkerConfigCustomizer<true>;
}
interface ResolvedAssetsOnlyConfig extends WorkerConfig {
  topLevelName: Defined<WorkerConfig["topLevelName"]>;
  name: Defined<WorkerConfig["name"]>;
  compatibility_date: Defined<WorkerConfig["compatibility_date"]>;
}
//#endregion
//#region src/index.d.ts
/**
 * Vite plugin that enables a full-featured integration between Vite and the Cloudflare Workers runtime.
 *
 * See the [README](https://github.com/cloudflare/workers-sdk/tree/main/packages/vite-plugin-cloudflare#readme) for more details.
 *
 * @param pluginConfig An optional {@link PluginConfig} object.
 */
declare function cloudflare(pluginConfig?: PluginConfig): vite.Plugin[];
//#endregion
export { type PluginConfig, type WorkerConfig, cloudflare, getLocalWorkerdCompatibilityDate };
//# sourceMappingURL=index.d.mts.map