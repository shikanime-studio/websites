{"version":3,"file":"handleCreateMiddleware.js","sources":["../../../src/start-compiler-plugin/handleCreateMiddleware.ts"],"sourcesContent":["import { stripMethodCall } from './utils'\nimport type { CompilationContext, RewriteCandidate } from './types'\n\n/**\n * Handles createMiddleware transformations for a batch of candidates.\n *\n * @param candidates - All Middleware candidates to process\n * @param context - The compilation context\n */\nexport function handleCreateMiddleware(\n  candidates: Array<RewriteCandidate>,\n  context: CompilationContext,\n): void {\n  if (context.env === 'server') {\n    throw new Error('handleCreateMiddleware should not be called on the server')\n  }\n\n  for (const candidate of candidates) {\n    const { inputValidator, server } = candidate.methodChain\n\n    if (inputValidator) {\n      const innerInputExpression = inputValidator.callPath.node.arguments[0]\n\n      if (!innerInputExpression) {\n        throw new Error(\n          'createMiddleware().inputValidator() must be called with a validator!',\n        )\n      }\n\n      // remove the validator call expression\n      stripMethodCall(inputValidator.callPath)\n    }\n\n    if (server) {\n      // remove the server call expression\n      stripMethodCall(server.callPath)\n    }\n  }\n}\n"],"names":[],"mappings":";AASO,SAAS,uBACd,YACA,SACM;AACN,MAAI,QAAQ,QAAQ,UAAU;AAC5B,UAAM,IAAI,MAAM,2DAA2D;AAAA,EAC7E;AAEA,aAAW,aAAa,YAAY;AAClC,UAAM,EAAE,gBAAgB,OAAA,IAAW,UAAU;AAE7C,QAAI,gBAAgB;AAClB,YAAM,uBAAuB,eAAe,SAAS,KAAK,UAAU,CAAC;AAErE,UAAI,CAAC,sBAAsB;AACzB,cAAM,IAAI;AAAA,UACR;AAAA,QAAA;AAAA,MAEJ;AAGA,sBAAgB,eAAe,QAAQ;AAAA,IACzC;AAEA,QAAI,QAAQ;AAEV,sBAAgB,OAAO,QAAQ;AAAA,IACjC;AAAA,EACF;AACF;"}