{"version":3,"file":"handleCreateIsomorphicFn.js","sources":["../../../src/start-compiler-plugin/handleCreateIsomorphicFn.ts"],"sourcesContent":["import * as t from '@babel/types'\nimport type { CompilationContext, RewriteCandidate } from './types'\n\n/**\n * Handles createIsomorphicFn transformations for a batch of candidates.\n *\n * @param candidates - All IsomorphicFn candidates to process\n * @param context - The compilation context\n */\nexport function handleCreateIsomorphicFn(\n  candidates: Array<RewriteCandidate>,\n  context: CompilationContext,\n): void {\n  for (const candidate of candidates) {\n    const { path, methodChain } = candidate\n\n    // Get the environment-specific call (.client() or .server())\n    const envCallInfo =\n      context.env === 'client' ? methodChain.client : methodChain.server\n\n    if (!envCallInfo) {\n      // No implementation for this environment - replace with no-op\n      path.replaceWith(t.arrowFunctionExpression([], t.blockStatement([])))\n      continue\n    }\n\n    // Extract the function argument from the environment-specific call\n    const innerFn = envCallInfo.firstArgPath?.node\n\n    if (!t.isExpression(innerFn)) {\n      throw new Error(\n        `createIsomorphicFn().${context.env}(func) must be called with a function!`,\n      )\n    }\n\n    path.replaceWith(innerFn)\n  }\n}\n"],"names":[],"mappings":";AASO,SAAS,yBACd,YACA,SACM;AACN,aAAW,aAAa,YAAY;AAClC,UAAM,EAAE,MAAM,YAAA,IAAgB;AAG9B,UAAM,cACJ,QAAQ,QAAQ,WAAW,YAAY,SAAS,YAAY;AAE9D,QAAI,CAAC,aAAa;AAEhB,WAAK,YAAY,EAAE,wBAAwB,CAAA,GAAI,EAAE,eAAe,CAAA,CAAE,CAAC,CAAC;AACpE;AAAA,IACF;AAGA,UAAM,UAAU,YAAY,cAAc;AAE1C,QAAI,CAAC,EAAE,aAAa,OAAO,GAAG;AAC5B,YAAM,IAAI;AAAA,QACR,wBAAwB,QAAQ,GAAG;AAAA,MAAA;AAAA,IAEvC;AAEA,SAAK,YAAY,OAAO;AAAA,EAC1B;AACF;"}